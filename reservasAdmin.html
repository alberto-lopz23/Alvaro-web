<!DOCTYPE html5>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reservas guardadas</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="firebaseConfig.js"></script>
  <script>
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f7faff;
      color: #222;
      padding: 40px;
    }
    h2 {
      text-align: center;
      margin-bottom: 30px;
    }
    .btn-group {
      text-align: center;
      margin-bottom: 30px;
    }
    .btn {
      background: #003366;
      color: #fff;
      border: none;
      padding: 10px 24px;
      margin: 0 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1em;
      transition: background 0.2s;
    }
    .btn.active, .btn:hover {
      background: #0055a5;
    }
    ul {
      list-style: none;
      padding: 0;
      max-width: 500px;
      margin: 0 auto;
    }
    li {
      background: #fff;
      margin-bottom: 12px;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      cursor: pointer;
      transition: box-shadow 0.2s;
    }
    li:hover {
      box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    }
    .info {
      margin-top: 24px;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
      background: #e6f2ff;
      padding: 18px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .completar-btn {
      background: #28a745;
      color: #fff;
      border: none;
      padding: 6px 16px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
      font-size: 0.95em;
    }
  </style>
</head>
<body>
  <h2>Reservas guardadas</h2>
  <div class="btn-group">
    <button id="pendientesBtn" class="btn active">Pendientes</button>
    <button id="completadosBtn" class="btn">Completado</button>
  </div>
  <div id="listaReservas"></div>
  <div id="infoReserva" class="info" style="display:none;"></div>
  <script>
    let reservas = {};
    let estadoActual = 'pendiente';

    function renderLista() {
      let html = '<ul>';
      Object.keys(reservas).forEach(function(key) {
        let r = reservas[key];
        if ((estadoActual === 'pendiente' && !r.completado) ||
            (estadoActual === 'completado' && r.completado)) {
          html += `<li onclick="mostrarInfo('${key}')">${r.nombre}</li>`;
        }
      });
      html += '</ul>';
      document.getElementById('listaReservas').innerHTML = html;
      document.getElementById('infoReserva').style.display = 'none';
    }

           function mostrarInfo(key) {
      let r = reservas[key];
      let html = `
        <strong>Nombre:</strong> ${r.nombre}<br>
        <strong>Tel√©fono:</strong> ${r.telefono}<br>
        <strong>Ruta:</strong> ${r.ruta}<br>
        <strong>Costo:</strong> ${r.costo}<br>
        <strong>Fecha de salida:</strong> ${r.fechaSalida || '-'}<br>
        <strong>Hora de salida:</strong> ${r.horaSalida || '-'}<br>
        <strong>Fecha de regreso:</strong> ${r.fechaRegreso || '-'}<br>
        <strong>Hora de recogida:</strong> ${r.horaRegreso || '-'}<br>
        <strong>Fecha de registro:</strong> ${r.fecha || '-'}<br>
      `;
      if (!r.completado) {
        html += `<button class="completar-btn" onclick="marcarCompletado('${key}')">Marcar como completado</button>`;
      }
      // Muestra la nota si falta fecha u hora de regreso
      if (!r.fechaRegreso || !r.horaRegreso) {
        html += `<p style="color: red;"><em>Nota: Esta reserva no tiene fecha u hora de regreso asignadas.</em></p>`;
      }
      document.getElementById('infoReserva').innerHTML = html;
      document.getElementById('infoReserva').style.display = 'block';
    }

    function marcarCompletado(key) {
      db.ref('reservas/' + key).update({completado: true});
      document.getElementById('infoReserva').style.display = 'none';
    }

    db.ref('reservas').on('value', function(snapshot) {
      reservas = {};
      snapshot.forEach(function(child) {
        reservas[child.key] = child.val();
      });
      renderLista();
    });

    document.getElementById('pendientesBtn').onclick = function() {
      estadoActual = 'pendiente';
      this.classList.add('active');
      document.getElementById('completadosBtn').classList.remove('active');
      renderLista();
    };
    document.getElementById('completadosBtn').onclick = function() {
      estadoActual = 'completado';
      this.classList.add('active');
      document.getElementById('pendientesBtn').classList.remove('active');
      renderLista();
    };

    // Permite que mostrarInfo y marcarCompletado sean accesibles globalmente
    window.mostrarInfo = mostrarInfo;
    window.marcarCompletado = marcarCompletado;
  </script>
</body>
</html>